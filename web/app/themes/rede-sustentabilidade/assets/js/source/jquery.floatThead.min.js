/*
 jQuery.floatThead 1.1.1
 Copyright (c) 2013 Misha Koryak - http://mkoryak.github.io/floatThead/
 Licensed under http://creativecommons.org/licenses/by-sa/4.0/
 */
(function(a){function ea(a,c){var d=l.width(),fa=_.debounce(function(){var a=l.width();d!=a&&(d=a,c())},a);l.bind("resize.floatTHead",fa)}function ga(){var e=a('<div style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');a("body").append(e);var c=e.innerWidth(),d=a("div",e).innerWidth();e.remove();return c-d}function ha(a){if(a.dataTableSettings)for(var c=0;c<a.dataTableSettings.length;c++)if(a[0]==a.dataTableSettings[c].nTable)return!0;
  return!1}var D=function(){for(var a=3,c=document.createElement("b"),d=c.all||[];c.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i><![endif]--\x3e",d[0];);return 4<a?a:document.documentMode}(),v=null,I=function(){if(D)return!1;var e=a("<table><colgroup><col></colgroup><tbody><tr><td style='width:10px'></td></tbody></table>");a("body").append(e);var c=e.find("col").width();e.remove();return 0==c};a.floatThead={defaults:{cellTag:"th",zIndex:1001,debounceResizeMs:1,useAbsolutePositioning:!0,scrollingTop:0,scrollingBottom:0,
  scrollContainer:function(e){return a([])},getSizingRow:function(a,c,d){return a.find("tbody tr:visible:first>td")},floatTableClass:"floatThead-table"}};var l=a(window),J=0;a.fn.floatThead=function(e){if(8>D)return this;null==v&&(v=I())&&(document.createElement("fthtr"),document.createElement("fthtd"),document.createElement("fthfoot"));if(_.isString(e)){var c=this;this.filter("table").each(function(){var d=a(this).data("floatThead-attached");d&&_.isFunction(d[e])&&(r=d[e](),"undefined"!==typeof r&&
  (c=r))});return c}var d=a.extend({},a.floatThead.defaults,e);this.filter(":not(."+d.floatTableClass+")").each(function(){function c(){var g=t.outerHeight(!0);K.outerHeight(g);ia.outerHeight(g)}function e(){w=(_.isFunction(d.scrollingTop)?d.scrollingTop(b):d.scrollingTop)||0;W=(_.isFunction(d.scrollingBottom)?d.scrollingBottom(b):d.scrollingBottom)||0}function I(){var g=t.find("tr:first>"+d.cellTag),g=_.reduce(g,function(g,b){var d=parseInt(a(b).attr("colspan")||1,10);return g+d},0);if(g!=X){X=g;for(var b=
  [],p=[],f=[],h=0;h<g;h++)b.push("<"+d.cellTag+' class="floatThead-col-'+h+'"/>'),p.push("<col/>"),f.push("<fthtd style='display:table-cell;height:0;width:auto;'/>");p=p.join("");b=b.join("");v&&(f=f.join(""),L.html(f),M=L.find("fthtd"));K.html(b);E.html(p);F=E.find("col");N.html(p);O=N.find("col")}return g}function G(){H||(H=!0,b.css(Y),n.css(Y),n.append(t),ja.before(A),c())}function P(){H&&(H=!1,A.detach(),b.prepend(t),b.css(B),n.css(B))}function Z(g){q!=g&&(q=g,k.css({position:q?"absolute":"fixed"}))}
  function Q(){var g,a=I();return function(){var p=!1,f;f=F;f=v?M:D?d.getSizingRow(b,f,M):f;if(f.length==a&&0<a){P();for(g=0;g<a;g++){var h=f.eq(g).outerWidth(!0);O.eq(g).outerWidth(h);F.eq(g).outerWidth(h)}G();for(g=0;g<a;g++)if(f=O.eq(g).outerWidth(!0),h=F.eq(g).outerWidth(!0),f!=h){p=!0;break}}else n.append(t),b.css(B),n.css(B),c();return p}}function R(){var a=m.scrollTop(),d,p=0,f=k.height(),h=b.offset();if(u)var c=m.offset(),p=h.top-c.top+a;else d=h.top-w-f+W+C.horizontal;var e=l.scrollTop(),n=
    l.scrollLeft(),t=m.scrollLeft(),a=m.scrollTop();return function(c){"windowScroll"==c?(e=l.scrollTop(),n=l.scrollLeft()):"containerScroll"==c?(a=m.scrollTop(),t=m.scrollLeft()):"init"!=c&&(e=l.scrollTop(),n=l.scrollLeft(),a=m.scrollTop(),t=m.scrollLeft());if(!v||!(0>e||0>n)){if(ka)"windowScrollDone"==c?Z(!0):Z(!1);else if("windowScrollDone"==c)return null;h=b.offset();var k,s;u&&q?(p>=a?(c=p-a,k=0<c?c:0):k=$?0:a,s=0):!u&&q?(c=b.outerHeight(),e>d+c?k=c-f:h.top>e+w?(k=0,P()):(k=w+e-h.top+p,G()),s=0):
    u&&!q?(p>a?(k=h.top-e,P()):(k=h.top+a-e-p,G()),s=h.left+t-n):u||q||(c=b.outerHeight(),e>d+c?k=c+w-e+d:h.top>e+w?(k=h.top-e,G()):k=w,s=h.left-n);return{top:k,left:s}}}}function aa(){var a=null,d=null,e=null;return function(f,h,l){null==f||a==f.top&&d==f.left||(k.css({top:f.top,left:f.left}),a=f.top,d=f.left);h&&(f=b.outerWidth(),h=m.width()||f,k.width(h-C.vertical),u?n.css("width",100*f/(h-C.vertical)+"%"):n.outerWidth(f));l&&c();l=m.scrollLeft();e!=l&&(k.scrollLeft(l),e=l)}}function S(){m.length&&
  (C.horizontal=m.width()<b.width()?ba:0,C.vertical=m.height()<b.height()?ba:0)}var b=a(this);if(b.data("floatThead-attached"))return!0;if(!b.is("table"))throw Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');var t=b.find("thead:first"),ja=b.find("tbody:first");if(0==t.length)throw Error("jQuery.floatThead must be run on a table that contains a <thead> element");var H=!0,w,W,C={vertical:0,horizontal:0},ba=ga(),X=0,m=d.scrollContainer(b)||a([]),q=d.useAbsolutePositioning;
  null==q&&(q=d.scrollContainer(b).length);var T=a('<fthfoot style="display:table-footer-group;"/>'),u=0<m.length,$=!1,ka=D&&!u&&q,n=a("<table/>"),N=a("<colgroup/>"),E=a("<colgroup/>"),L=a('<fthrow style="display:table-row;height:0;"/>'),k=a('<div style="overflow: hidden;"></div>'),A=a("<thead/>"),K=a('<tr class="size-row"/>'),ia=a([]),F=a([]),O=a([]),M=a([]);A.append(K);t.detach();b.prepend(A);b.prepend(E);v&&(T.append(L),b.append(T));n.append(N);k.append(n);n.attr("class",b.attr("class"));n.addClass(d.floatTableClass).css("margin",
    0);if(q){var ca=function(a,b){var c=a.css("position");if("relative"!=c&&"absolute"!=c||b)c={paddingLeft:a.css("paddingLeft"),paddingRight:a.css("paddingRight")},k.css(c),a=a.wrap("<div style='position: relative; clear:both;'></div>").parent(),$=!0;return a};u?ca(m,!0).append(k):(ca(b),b.after(k))}else b.after(k);k.css({position:q?"absolute":"fixed",marginTop:0,top:q?0:"auto",zIndex:d.zIndex});e();var Y={"table-layout":"fixed"},B={"table-layout":b.css("tableLayout")||"auto"};S();var x=Q();x();var s=
    R(),y=aa();y(s("init"),!0);var la=_.debounce(function(){y(s("windowScrollDone"),!1)},300),U=function(){y(s("windowScroll"),!1);la()},V=function(){y(s("containerScroll"),!1)},da=function(){e();S();x=Q();x()&&x();s=R();y=aa();y(s("resize"),!0,!0)},z=_.debounce(function(){S();e();x=Q();x()&&x();s=R();y(s("reflow"),!0)},1);u?q?m.bind("scroll.floatTHead",V):(m.bind("scroll.floatTHead",V),l.bind("scroll.floatTHead",U)):l.bind("scroll.floatTHead",U);l.bind("load.floatTHead",z);ea(d.debounceResizeMs,da);
  b.bind("reflow",z);ha(b)&&b.bind("filter",z).bind("sort",z).bind("page",z);b.data("floatThead-attached",{destroy:function(){b.css(B);E.remove();v&&T.remove();A.parent().length&&A.replaceWith(t);b.unbind("reflow");z=da=V=U=function(){};m.unbind("scroll.floatTHead");k.remove();b.data("floatThead-attached",!1);J--;0==J&&(l.unbind("scroll.floatTHead"),l.unbind("resize.floatTHead"),l.unbind("load.floatTHead"))},reflow:function(){z()},setHeaderHeight:function(){c()},getFloatContainer:function(){return k}});
  J++});return this}})(jQuery);
